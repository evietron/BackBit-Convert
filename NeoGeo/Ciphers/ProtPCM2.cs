// Contains parts from
// https://raw.githubusercontent.com/mamedev/mame/master/src/devices/bus/neogeo/prot_pcm2.cpp
// license:BSD-3-Clause
// copyright-holders:S. Smith,David Haywood,Fabio Priuli

using System;

public class ProtPCM2
{
    static readonly int[,] voice_addrs = {
		{0x000000,0xa5000},
		{0xffce20,0x01000},
		{0xfe2cf6,0x4e001},
		{0xffac28,0xc2000},
		{0xfeb2c0,0x0a000},
		{0xff14ea,0xa7001},
		{0xffb440,0x02000}};

    static readonly byte[,] voice_xordata = {
        {0xf9,0xe0,0x5d,0xf3,0xea,0x92,0xbe,0xef},
        {0xc4,0x83,0xa8,0x5f,0x21,0x27,0x64,0xaf},
        {0xc3,0xfd,0x81,0xac,0x6d,0xe7,0xbf,0x9e},
        {0xc3,0xfd,0x81,0xac,0x6d,0xe7,0xbf,0x9e},
        {0xcb,0x29,0x7d,0x43,0xd2,0x3a,0xc2,0xb4},
        {0x4b,0xa4,0x63,0x46,0xf0,0x91,0xea,0x62},
        {0x4b,0xa4,0x63,0x46,0xf0,0x91,0xea,0x62}};

    public static void Decrypt(byte[] rom, int val)
    {
        byte[] buf = new byte[rom.Length];
        Buffer.BlockCopy(rom, 0, buf, 0, rom.Length);
        for (int i = 0; i < 0x1000000; i++)
        {
            int j = (i & 0xfefffe) | ((i >> 16) & 1) | ((i & 1) << 16);
            j ^= voice_addrs[val,1];
            int d = ((i + voice_addrs[val,0]) & 0xffffff);
            rom[j] = (byte)(buf[d] ^ voice_xordata[val,j & 0x7]);
        }
    }
}
